(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue")):"function"===typeof define&&define.amd?define(["CoreHome"],t):"object"===typeof exports?exports["MultiSites"]=t(require("CoreHome"),require("vue")):e["MultiSites"]=t(e["CoreHome"],e["Vue"])})("undefined"!==typeof self?self:this,(function(e,t){return function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="plugins/MultiSites/vue/dist/",r(r.s="fae3")}({"19dc":function(t,r){t.exports=e},"8bbf":function(e,r){e.exports=t},fae3:function(e,t,r){"use strict";if(r.r(t),r.d(t,"AllWebsitesDashboard",(function(){return Le})),r.d(t,"MultisitesSite",(function(){return vt})),r.d(t,"DashboadStore",(function(){return St})),r.d(t,"Dashboard",(function(){return vr})),"undefined"!==typeof window){var a=window.document.currentScript,n=a&&a.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(r.p=n[1])}var o=r("8bbf"),i={class:"dashboardHeader"},s={class:"card-title"},l={key:0},c={class:"notification system notification-error"},u=Object(o["createElementVNode"])("br",null,null,-1),d=Object(o["createElementVNode"])("br",null,null,-1),m=["href"],b=Object(o["createTextVNode"])(" – "),p=["href"],v=Object(o["createTextVNode"])(" – "),h=["href"],O=Object(o["createTextVNode"])(". "),f={class:"dashboardControls"},g={class:"siteSearch"},j=["placeholder"],S=["title"],k=["href"];function y(e,t,r,a,n,y){var C=Object(o["resolveComponent"])("EnrichedHeadline"),_=Object(o["resolveComponent"])("KPICardContainer"),N=Object(o["resolveComponent"])("SitesTable");return Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,[Object(o["createElementVNode"])("div",i,[Object(o["createElementVNode"])("h1",s,[Object(o["createVNode"])(C,{"feature-name":e.translate("MultiSites_AllWebsitesDashboardTitle")},{default:Object(o["withCtx"])((function(){return[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("MultiSites_AllWebsitesDashboardTitle")),1)]})),_:1},8,["feature-name"])])]),e.errorLoading?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",l,[Object(o["createElementVNode"])("div",c,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("MultiSites_AllWebsitesDashboardErrorMessage"))+" ",1),u,d,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_NeedMoreHelp","",""))+" ",1),Object(o["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.externalRawLink("https://matomo.org/faq/troubleshooting/faq_19489/")},Object(o["toDisplayString"])(e.translate("General_Faq")),9,m),b,Object(o["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.externalRawLink("https://forum.matomo.org/")},Object(o["toDisplayString"])(e.translate("Feedback_CommunityHelp")),9,p),v,Object(o["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.externalRawLink("https://matomo.org/support-plans/")},Object(o["toDisplayString"])(e.translate("Feedback_ProfessionalHelp")),9,h),O])])):Object(o["createCommentVNode"])("",!0),Object(o["createVNode"])(_,{"is-loading":e.isLoadingKPIs,"model-value":e.kpis},null,8,["is-loading","model-value"]),Object(o["createElementVNode"])("div",f,[Object(o["createElementVNode"])("div",g,[Object(o["withDirectives"])(Object(o["createElementVNode"])("input",{type:"text",onKeydown:t[0]||(t[0]=Object(o["withKeys"])((function(t){return e.searchSite(e.searchTerm)}),["enter"])),"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.searchTerm=t}),placeholder:e.translate("Actions_SubmenuSitesearch")},null,40,j),[[o["vModelText"],e.searchTerm]]),Object(o["createElementVNode"])("span",{class:"icon-search",onClick:t[2]||(t[2]=function(t){return e.searchSite(e.searchTerm)}),title:e.translate("General_ClickToSearch")},null,8,S)]),!e.isWidgetized&&e.isUserAllowedToAddSite?(Object(o["openBlock"])(),Object(o["createElementBlock"])("a",{key:0,class:"btn",href:e.addSiteUrl},Object(o["toDisplayString"])(e.translate("SitesManager_AddSite")),9,k)):Object(o["createCommentVNode"])("",!0)]),Object(o["createVNode"])(N,{"display-revenue":e.displayRevenue,"display-sparklines":e.displaySparklines},null,8,["display-revenue","display-sparklines"])],64)}var C=r("19dc");function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function E(e,t,r){return t&&N(e.prototype,t),r&&N(e,r),e}function V(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var w="desc",T="nb_visits",B=function(){function e(){var t=this;_(this,e),V(this,"fetchAbort",null),V(this,"privateState",Object(o["reactive"])({dashboardKPIs:{badges:{},evolutionPeriod:"day",hits:"?",hitsCompact:"?",hitsEvolution:"",hitsTrend:0,pageviews:"?",pageviewsCompact:"?",pageviewsEvolution:"",pageviewsTrend:0,revenue:"?",revenueCompact:"?",revenueEvolution:"",revenueTrend:0,visits:"?",visitsCompact:"?",visitsEvolution:"",visitsTrend:0},dashboardSites:[],errorLoading:!1,isLoadingKPIs:!1,isLoadingSites:!1,numSites:0,paginationCurrentPage:0,sortColumn:T,sortOrder:w})),V(this,"autoRefreshInterval",0),V(this,"autoRefreshTimeout",null),V(this,"pageSize",25),V(this,"searchTerm",""),V(this,"state",Object(o["computed"])((function(){return Object(o["readonly"])(t.privateState)}))),V(this,"numberOfPages",Object(o["computed"])((function(){return Math.ceil(t.state.value.numSites/t.pageSize-1)}))),V(this,"currentPagingOffset",Object(o["computed"])((function(){return Math.ceil(t.state.value.paginationCurrentPage*t.pageSize)}))),V(this,"paginationLowerBound",Object(o["computed"])((function(){return 0===t.state.value.numSites?0:1+t.currentPagingOffset.value}))),V(this,"paginationUpperBound",Object(o["computed"])((function(){if(0===t.state.value.numSites)return 0;var e=t.pageSize+t.currentPagingOffset.value,r=t.state.value.numSites;return e<r?e:r})))}return E(e,[{key:"reloadDashboard",value:function(){this.privateState.sortColumn=T,this.privateState.sortOrder=w,this.privateState.paginationCurrentPage=0,this.refreshData()}},{key:"navigateNextPage",value:function(){this.privateState.paginationCurrentPage!==this.numberOfPages.value&&(this.privateState.paginationCurrentPage+=1,this.refreshData(!0))}},{key:"navigatePreviousPage",value:function(){0!==this.privateState.paginationCurrentPage&&(this.privateState.paginationCurrentPage-=1,this.refreshData(!0))}},{key:"searchSite",value:function(e){this.searchTerm=e,this.privateState.paginationCurrentPage=0,this.refreshData(!0)}},{key:"setAutoRefreshInterval",value:function(e){this.autoRefreshInterval=e}},{key:"setPageSize",value:function(e){this.pageSize=e}},{key:"sortBy",value:function(e){this.privateState.sortColumn===e?this.privateState.sortOrder="desc"===this.privateState.sortOrder?"asc":"desc":this.privateState.sortOrder="label"===e?"asc":"desc",this.privateState.sortColumn=e,this.refreshData(!0)}},{key:"cancelAutoRefresh",value:function(){this.autoRefreshTimeout&&(clearTimeout(this.autoRefreshTimeout),this.autoRefreshTimeout=null)}},{key:"refreshData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.fetchAbort&&(this.fetchAbort.abort(),this.fetchAbort=null,this.cancelAutoRefresh()),this.fetchAbort=new AbortController,this.privateState.errorLoading=!1,this.privateState.isLoadingKPIs=!t,this.privateState.isLoadingSites=!0;var r={method:"MultiSites.getAllWithGroups",filter_limit:this.pageSize,filter_offset:this.currentPagingOffset.value,filter_sort_column:this.privateState.sortColumn,filter_sort_order:this.privateState.sortOrder,format_metrics:0,showColumns:["hits_evolution","hits_evolution_trend","label","hits","nb_pageviews","nb_visits","pageviews_evolution","pageviews_evolution_trend","revenue","revenue_evolution","revenue_evolution_trend","visits_evolution","visits_evolution_trend"].join(",")};return this.searchTerm&&(r.pattern=this.searchTerm),C["AjaxHelper"].fetch(r,{abortController:this.fetchAbort,createErrorNotification:!1}).then((function(r){t||(e.updateDashboardKPIs(r),C["Matomo"].postEvent("MultiSites.DashboardKPIs.updated",{parameters:(new C["AjaxHelper"]).mixinDefaultGetParams({filter_limit:e.pageSize,filter_offset:e.currentPagingOffset.value,filter_sort_column:e.privateState.sortColumn,filter_sort_order:e.privateState.sortOrder,pattern:e.searchTerm}),kpis:e.privateState.dashboardKPIs})),e.updateDashboardSites(r)})).catch((function(){e.privateState.dashboardSites=[],e.privateState.errorLoading=!0})).finally((function(){e.privateState.isLoadingKPIs=!1,e.privateState.isLoadingSites=!1,e.fetchAbort=null,e.startAutoRefresh()}))}},{key:"startAutoRefresh",value:function(){var e=this;if(this.cancelAutoRefresh(),!(this.autoRefreshInterval<=0)){var t;try{t=C["Periods"].parse(C["Matomo"].period,C["Matomo"].currentDateString)}catch(r){}t&&t.containsToday()&&(this.autoRefreshTimeout=setTimeout((function(){e.autoRefreshTimeout=null,e.refreshData()}),1e3*this.autoRefreshInterval))}}},{key:"updateDashboardKPIs",value:function(e){this.privateState.dashboardKPIs={badges:{hits:null,pageviews:null,revenue:null,visits:null},evolutionPeriod:C["Matomo"].period,hits:C["NumberFormatter"].formatNumber(e.totals.hits),hitsCompact:C["NumberFormatter"].formatNumberCompact(e.totals.hits),hitsEvolution:C["NumberFormatter"].calculateAndFormatEvolution(e.totals.hits,e.totals.previous_hits,!0),hitsTrend:Math.sign(e.totals.hits-e.totals.previous_hits),pageviews:C["NumberFormatter"].formatNumber(e.totals.nb_pageviews),pageviewsCompact:C["NumberFormatter"].formatNumberCompact(e.totals.nb_pageviews),pageviewsEvolution:C["NumberFormatter"].calculateAndFormatEvolution(e.totals.nb_pageviews,e.totals.previous_nb_pageviews,!0),pageviewsTrend:Math.sign(e.totals.nb_pageviews-e.totals.previous_nb_pageviews),revenue:C["NumberFormatter"].formatCurrency(e.totals.revenue,""),revenueCompact:C["NumberFormatter"].formatCurrencyCompact(e.totals.revenue,""),revenueEvolution:C["NumberFormatter"].calculateAndFormatEvolution(e.totals.revenue,e.totals.previous_revenue,!0),revenueTrend:Math.sign(e.totals.revenue-e.totals.previous_revenue),visits:C["NumberFormatter"].formatNumber(e.totals.nb_visits),visitsCompact:C["NumberFormatter"].formatNumberCompact(e.totals.nb_visits),visitsEvolution:C["NumberFormatter"].calculateAndFormatEvolution(e.totals.nb_visits,e.totals.previous_nb_visits,!0),visitsTrend:Math.sign(e.totals.nb_visits-e.totals.previous_nb_visits)}}},{key:"updateDashboardSites",value:function(e){this.privateState.dashboardSites=e.sites,this.privateState.numSites=e.numSites}}]),e}(),P=new B,M={class:"kpiCardContainer"},D={key:0,class:"kpiCard kpiCardLoading"},x=Object(o["createElementVNode"])("div",{class:"kpiCardTitle"}," ",-1),L={class:"kpiCardValue"},A=Object(o["createElementVNode"])("div",{class:"kpiCardEvolution"},[Object(o["createElementVNode"])("span",{class:"kpiCardEvolutionTrend"}," ")],-1),F={key:0,class:"kpiCardBadge"};function G(e,t,r,a,n,i){var s=Object(o["resolveComponent"])("MatomoLoader"),l=Object(o["resolveComponent"])("KPICard");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",M,[e.isLoading?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",D,[x,Object(o["createElementVNode"])("div",L,[Object(o["createVNode"])(s)]),A,e.hasKpiBadge?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",F," ")):Object(o["createCommentVNode"])("",!0)])):(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],{key:1},Object(o["renderList"])(e.kpis,(function(t,r){return Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],{key:"kpi-card-".concat(r)},[r>0?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",{key:0,class:Object(o["normalizeClass"])({kpiCardDivider:!0,kpiCardDividerBadge:e.hasKpiBadge})}," ",2)):Object(o["createCommentVNode"])("",!0),Object(o["createVNode"])(l,{"model-value":t},null,8,["model-value"])],64)})),128))])}var R={class:"kpiCard"},I={class:"kpiCardTitle"},z={style:{display:"none"},ref:"kpiCardTooltipTemplate"},U={role:"tooltip"},H=["title"],q={class:"kpiCardEvolution"},K={key:1,class:"kpiCardEvolution"},W=Object(o["createElementVNode"])("span",{class:"kpiCardEvolutionTrend"}," ",-1),$=[W],J=["title","innerHTML"];function Y(e,t,r,a,n,i){var s=Object(o["resolveDirective"])("tooltips");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",R,[Object(o["createElementVNode"])("div",I,[Object(o["createElementVNode"])("span",{class:Object(o["normalizeClass"])("kpiCardIcon ".concat(e.kpi.icon))},null,2),Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate(e.kpi.title)),1)]),Object(o["createElementVNode"])("div",z,[Object(o["createElementVNode"])("div",U,[Object(o["createElementVNode"])("h3",null,Object(o["toDisplayString"])(e.translate(e.kpi.title)),1),Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.kpi.value),1)])],512),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",{class:"kpiCardValue",title:e.kpi.value},[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.kpi.valueCompact),1)],8,H),[[s,{duration:200,delay:200,content:e.tooltipContent}]]),Object(o["createElementVNode"])("div",q,[""!==e.kpi.evolutionValue?(Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],{key:0},[Object(o["createElementVNode"])("span",{class:Object(o["normalizeClass"])("kpiCardEvolutionTrend ".concat(e.evolutionTrendClass))},[Object(o["createElementVNode"])("span",{class:Object(o["normalizeClass"])("kpiCardEvolutionIcon ".concat(e.evolutionTrendIcon))},null,2),Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.kpi.evolutionValue)+"  ",1)],2),Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(e.translate(e.evolutionTrendFrom)),1)],64)):(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",K,$))]),e.kpi.badge?Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createElementBlock"])("div",{key:0,class:"kpiCardBadge",title:e.kpi.badge.title,innerHTML:e.$sanitize(e.kpi.badge.label)},null,8,J)),[[s,{duration:200,delay:200}]]):Object(o["createCommentVNode"])("",!0)])}var Q=Object(o["defineComponent"])({directives:{Tooltips:C["Tooltips"]},props:{modelValue:{type:Object,required:!0}},computed:{tooltipContent:function(){var e=this;return function(){var t;return(null===(t=e.$refs.kpiCardTooltipTemplate)||void 0===t?void 0:t.innerHTML)||""}},evolutionTrendFrom:function(){switch(this.kpi.evolutionPeriod){case"day":return"MultiSites_EvolutionFromPreviousDay";case"week":return"MultiSites_EvolutionFromPreviousWeek";case"month":return"MultiSites_EvolutionFromPreviousMonth";case"year":return"MultiSites_EvolutionFromPreviousYear";default:return"MultiSites_EvolutionFromPreviousPeriod"}},evolutionTrendClass:function(){return 1===this.kpi.evolutionTrend?"kpiTrendPositive":-1===this.kpi.evolutionTrend?"kpiTrendNegative":"kpiTrendNeutral"},evolutionTrendIcon:function(){return 1===this.kpi.evolutionTrend?"icon-chevron-up":-1===this.kpi.evolutionTrend?"icon-chevron-down":"icon-circle"},kpi:function(){return this.modelValue}}});Q.render=Y;var X=Q,Z=Object(o["defineComponent"])({components:{MatomoLoader:C["MatomoLoader"],KPICard:X},props:{isLoading:Boolean,modelValue:{type:Array,required:!0}},computed:{hasKpiBadge:function(){return this.kpis.some((function(e){return!!e.badge}))},kpis:function(){return this.modelValue}}});Z.render=G;var ee=Z,te={class:"sitesTableContainer"},re={class:"card-table dataTable sitesTable"},ae={class:"sitesTableEvolutionSelector"},ne=["value"],oe={value:"hits_evolution"},ie={value:"visits_evolution"},se={value:"pageviews_evolution"},le={key:0,value:"revenue_evolution"},ce={key:0},ue={class:"sitesTableLoading",colspan:"7"},de={key:0,class:"sitesTablePagination"},me={class:"dataTablePages"};function be(e,t,r,a,n,i){var s=Object(o["resolveComponent"])("MatomoLoader"),l=Object(o["resolveComponent"])("SitesTableSite");return Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,[Object(o["createElementVNode"])("div",te,[Object(o["createElementVNode"])("table",re,[Object(o["createElementVNode"])("thead",null,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("th",{onClick:t[0]||(t[0]=function(t){return e.sortBy("label")}),class:"label"},[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("General_Website"))+" ",1),"label"===e.sortColumn?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:0,class:Object(o["normalizeClass"])(e.sortColumnClass)},null,2)):Object(o["createCommentVNode"])("",!0)]),Object(o["createElementVNode"])("th",{onClick:t[1]||(t[1]=function(t){return e.sortBy("nb_visits")})},["nb_visits"===e.sortColumn?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:0,class:Object(o["normalizeClass"])(e.sortColumnClass)},null,2)):Object(o["createCommentVNode"])("",!0),Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_ColumnNbVisits")),1)]),Object(o["createElementVNode"])("th",{onClick:t[2]||(t[2]=function(t){return e.sortBy("nb_pageviews")})},["nb_pageviews"===e.sortColumn?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:0,class:Object(o["normalizeClass"])(e.sortColumnClass)},null,2)):Object(o["createCommentVNode"])("",!0),Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_ColumnPageviews")),1)]),Object(o["createElementVNode"])("th",{onClick:t[3]||(t[3]=function(t){return e.sortBy("hits")})},["hits"===e.sortColumn?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:0,class:Object(o["normalizeClass"])(e.sortColumnClass)},null,2)):Object(o["createCommentVNode"])("",!0),Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_ColumnHits")),1)]),e.displayRevenue?(Object(o["openBlock"])(),Object(o["createElementBlock"])("th",{key:0,onClick:t[4]||(t[4]=function(t){return e.sortBy("revenue")})},["revenue"===e.sortColumn?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:0,class:Object(o["normalizeClass"])(e.sortColumnClass)},null,2)):Object(o["createCommentVNode"])("",!0),Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_ColumnRevenue")),1)])):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("th",{onClick:t[5]||(t[5]=function(t){return e.sortBy(e.evolutionSelector)})},[e.sortColumn===e.evolutionSelector?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:0,class:Object(o["normalizeClass"])(e.sortColumnClass)},null,2)):Object(o["createCommentVNode"])("",!0),Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("MultiSites_Evolution")),1)]),Object(o["createElementVNode"])("th",ae,[Object(o["createElementVNode"])("select",{class:"browser-default",value:e.evolutionSelector,onChange:t[6]||(t[6]=function(t){return e.changeEvolutionSelector(t.target.value)})},[Object(o["createElementVNode"])("option",oe,Object(o["toDisplayString"])(e.translate("General_ColumnHits")),1),Object(o["createElementVNode"])("option",ie,Object(o["toDisplayString"])(e.translate("General_ColumnNbVisits")),1),Object(o["createElementVNode"])("option",se,Object(o["toDisplayString"])(e.translate("General_ColumnPageviews")),1),e.displayRevenue?(Object(o["openBlock"])(),Object(o["createElementBlock"])("option",le,Object(o["toDisplayString"])(e.translate("General_ColumnRevenue")),1)):Object(o["createCommentVNode"])("",!0)],40,ne)])])]),Object(o["createElementVNode"])("tbody",null,[e.isLoading?(Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",ce,[Object(o["createElementVNode"])("td",ue,[Object(o["createVNode"])(s)])])):(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],{key:1},Object(o["renderList"])(e.sites,(function(t){return Object(o["openBlock"])(),Object(o["createBlock"])(l,{"display-revenue":e.displayRevenue,"evolution-metric":e.evolutionMetric,key:"site-".concat(t.idsite),"model-value":t,"display-sparkline":e.displaySparklines,"sparkline-metric":e.sparklineMetric},null,8,["display-revenue","evolution-metric","model-value","display-sparkline","sparkline-metric"])})),128))])])]),!e.isLoading||e.paginationUpperBound>0?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",de,[Object(o["withDirectives"])(Object(o["createElementVNode"])("span",{class:"dataTablePrevious",onClick:t[7]||(t[7]=function(t){return e.navigatePreviousPage()})}," « "+Object(o["toDisplayString"])(e.translate("General_Previous")),513),[[o["vShow"],0!==e.paginationCurrentPage]]),Object(o["createElementVNode"])("span",me,Object(o["toDisplayString"])(e.translate("General_Pagination",e.paginationLowerBound,e.paginationUpperBound,e.numberOfFilteredSites)),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",{class:"dataTableNext",onClick:t[8]||(t[8]=function(t){return e.navigateNextPage()})},Object(o["toDisplayString"])(e.translate("General_Next"))+" » ",513),[[o["vShow"],e.paginationCurrentPage<e.paginationMaxPage]])])):Object(o["createCommentVNode"])("",!0)],64)}var pe={class:"label"},ve=["href","title"],he=Object(o["createElementVNode"])("span",{class:"icon icon-outlink"},null,-1),Oe=[he],fe=["href"],ge={key:1,class:"value"},je={class:"value"},Se={class:"value"},ke={class:"value"},ye={key:0},Ce={class:"value"},_e=["colspan"],Ne=["src"],Ee={key:1,class:"sitesTableSparkline"},Ve=["href","title"],we=["src"];function Te(e,t,r,a,n,i){return Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",{class:Object(o["normalizeClass"])({sitesTableGroup:!!e.site.isGroup,sitesTableGroupSite:!e.site.isGroup&&!!e.site.group,sitesTableSite:!e.site.isGroup&&!e.site.group})},[Object(o["createElementVNode"])("td",pe,[e.site.isGroup?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",ge,Object(o["toDisplayString"])(e.siteLabel),1)):(Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],{key:0},[Object(o["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.site.main_url,title:e.translate("General_GoTo",e.site.main_url)},Oe,8,ve),Object(o["createElementVNode"])("a",{title:"View reports",class:"value",href:e.dashboardUrl},Object(o["toDisplayString"])(e.siteLabel),9,fe)],64))]),Object(o["createElementVNode"])("td",null,[Object(o["createElementVNode"])("span",je,Object(o["toDisplayString"])(e.formatNumber(e.site.nb_visits)),1)]),Object(o["createElementVNode"])("td",null,[Object(o["createElementVNode"])("span",Se,Object(o["toDisplayString"])(e.formatNumber(e.site.nb_pageviews)),1)]),Object(o["createElementVNode"])("td",null,[Object(o["createElementVNode"])("span",ke,Object(o["toDisplayString"])(e.formatNumber(e.site.hits)),1)]),e.displayRevenue?(Object(o["openBlock"])(),Object(o["createElementBlock"])("td",ye,[Object(o["createElementVNode"])("span",Ce,Object(o["toDisplayString"])(e.formatCurrency(e.site.revenue,e.site.currencySymbol||"")),1)])):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("td",{colspan:e.displaySparkline?1:2},[!e.site.isGroup&&e.sparklineMetric in e.site?(Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],{key:0},[Object(o["createElementVNode"])("img",{src:e.evolutionIconSrc,alt:""},null,8,Ne),Object(o["createElementVNode"])("span",{class:Object(o["normalizeClass"])(e.evolutionTrendClass)},Object(o["toDisplayString"])(e.calculateAndFormatEvolution(e.site[e.sparklineMetric],e.site["previous_".concat(e.sparklineMetric)]*e.site.ratio,!0)),3)],64)):Object(o["createCommentVNode"])("",!0)],8,_e),e.displaySparkline?(Object(o["openBlock"])(),Object(o["createElementBlock"])("td",Ee,[e.site.isGroup?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createElementBlock"])("a",{key:0,rel:"noreferrer noopener",target:"_blank",href:e.dashboardUrl,title:e.translate("General_GoTo",e.translate("Dashboard_DashboardOf",e.siteLabel))},[Object(o["createElementVNode"])("img",{alt:"",width:"100",height:"25",src:e.evolutionSparklineSrc},null,8,we)],8,Ve))])):Object(o["createCommentVNode"])("",!0)],2)}var Be=Object(o["defineComponent"])({props:{displayRevenue:{type:Boolean,required:!0},evolutionMetric:{type:String,required:!0},modelValue:{type:Object,required:!0},sparklineMetric:String,displaySparkline:Boolean},computed:{dashboardUrl:function(){var e=C["MatomoUrl"].stringify({module:"CoreHome",action:"index",date:C["Matomo"].currentDateString,period:C["Matomo"].period,idSite:this.site.idsite});return"?".concat(e).concat(this.tokenParam)},evolutionIconSrc:function(){return 1===this.evolutionTrend?"plugins/MultiSites/images/arrow_up.png":-1===this.evolutionTrend?"plugins/MultiSites/images/arrow_down.png":"plugins/MultiSites/images/stop.png"},evolutionSparklineSrc:function(){var e=C["Matomo"].currentDateString;if("range"!==C["Matomo"].period){var t=C["Range"].getLastNRange(C["Matomo"].period,"30",C["Matomo"].currentDateString),r=t.startDate,a=t.endDate;e="".concat(Object(C["format"])(r),",").concat(Object(C["format"])(a))}var n=C["MatomoUrl"].stringify({module:"MultiSites",action:"getEvolutionGraph",date:e,period:C["Matomo"].period,idSite:this.site.idsite,columns:this.sparklineMetric,evolutionBy:this.sparklineMetric,colors:JSON.stringify(C["Matomo"].getSparklineColors()),viewDataTable:"sparkline"});return"?".concat(n).concat(this.tokenParam)},evolutionTrend:function(){var e="".concat(this.evolutionMetric,"_trend");return this.site[e]},evolutionTrendClass:function(){return 1===this.evolutionTrend?"evolutionTrendPositive":-1===this.evolutionTrend?"evolutionTrendNegative":""},site:function(){return this.modelValue},siteLabel:function(){return C["Matomo"].helper.htmlDecode(this.site.label)},tokenParam:function(){var e=C["MatomoUrl"].urlParsed.value.token_auth;return e?"&token_auth=".concat(e):""}}});Be.render=Te;var Pe=Be,Me=Object(o["defineComponent"])({components:{MatomoLoader:C["MatomoLoader"],SitesTableSite:Pe},props:{displayRevenue:{type:Boolean,required:!0},displaySparklines:{type:Boolean,required:!0}},data:function(){return{evolutionSelector:"visits_evolution"}},computed:{errorLoading:function(){return P.state.value.errorLoading},errorShowProfessionalHelp:function(){return C["Matomo"].config&&C["Matomo"].config.are_ads_enabled},evolutionMetric:function(){return this.evolutionSelector},isLoading:function(){return P.state.value.isLoadingSites},numberOfFilteredSites:function(){return P.state.value.numSites},paginationCurrentPage:function(){return P.state.value.paginationCurrentPage},paginationLowerBound:function(){return P.paginationLowerBound.value},paginationUpperBound:function(){return P.paginationUpperBound.value},paginationMaxPage:function(){return P.numberOfPages.value},sites:function(){return P.state.value.dashboardSites},sortColumn:function(){return P.state.value.sortColumn},sortColumnClass:function(){return{sitesTableSort:!0,sitesTableSortAsc:"asc"===this.sortOrder,sitesTableSortDesc:"desc"===this.sortOrder}},sortOrder:function(){return P.state.value.sortOrder},sparklineMetric:function(){switch(this.evolutionMetric){case"hits_evolution":return"hits";case"pageviews_evolution":return"nb_pageviews";case"revenue_evolution":return"revenue";case"visits_evolution":return"nb_visits";default:return""}}},methods:{changeEvolutionSelector:function(e){this.evolutionSelector=e,this.sortBy(e)},navigateNextPage:function(){P.navigateNextPage()},navigatePreviousPage:function(){P.navigatePreviousPage()},sortBy:function(e){P.sortBy(e)}}});Me.render=be;var De=Me,xe=Object(o["defineComponent"])({components:{EnrichedHeadline:C["EnrichedHeadline"],KPICardContainer:ee,SitesTable:De},props:{autoRefreshInterval:{type:Number,required:!0},displayRevenue:{type:Boolean,required:!0},displaySparklines:{type:Boolean,required:!0},isWidgetized:{type:Boolean,required:!0},pageSize:{type:Number,required:!0}},data:function(){return{searchTerm:""}},mounted:function(){Object(o["watch"])((function(){return C["MatomoUrl"].hashParsed.value}),(function(){return P.reloadDashboard()})),P.setAutoRefreshInterval(this.autoRefreshInterval),P.setPageSize(this.pageSize),P.reloadDashboard()},computed:{addSiteUrl:function(){return"?".concat(C["MatomoUrl"].stringify(Object.assign(Object.assign(Object.assign({},C["MatomoUrl"].urlParsed.value),C["MatomoUrl"].hashParsed.value),{},{module:"SitesManager",action:"index",showaddsite:"1"})))},isLoadingKPIs:function(){return P.state.value.isLoadingKPIs},errorLoading:function(){return P.state.value.errorLoading},kpis:function(){var e,t,r,a,n=P.state.value.dashboardKPIs,o=[{badge:(null===(e=n.badges)||void 0===e?void 0:e.visits)||null,icon:"icon-user",title:"MultiSites_TotalVisits",value:n.visits,valueCompact:n.visitsCompact,evolutionPeriod:n.evolutionPeriod,evolutionTrend:n.visitsTrend,evolutionValue:n.visitsEvolution},{badge:(null===(t=n.badges)||void 0===t?void 0:t.pageviews)||null,icon:"icon-show",title:"MultiSites_TotalPageviews",value:n.pageviews,valueCompact:n.pageviewsCompact,evolutionPeriod:n.evolutionPeriod,evolutionTrend:n.pageviewsTrend,evolutionValue:n.pageviewsEvolution},{badge:(null===(r=n.badges)||void 0===r?void 0:r.hits)||null,icon:"icon-hits",title:"MultiSites_TotalHits",value:n.hits,valueCompact:n.hitsCompact,evolutionPeriod:n.evolutionPeriod,evolutionTrend:n.hitsTrend,evolutionValue:n.hitsEvolution}];this.displayRevenue&&o.push({badge:(null===(a=n.badges)||void 0===a?void 0:a.revenue)||null,icon:"icon-dollar-sign",title:"General_TotalRevenue",value:n.revenue,valueCompact:n.revenueCompact,evolutionPeriod:n.evolutionPeriod,evolutionTrend:n.revenueTrend,evolutionValue:n.revenueEvolution});return o},isUserAllowedToAddSite:function(){return C["Matomo"].hasSuperUserAccess}},methods:{searchSite:function(e){P.searchSite(e)}}});xe.render=y;var Le=xe,Ae={key:0,class:"multisites-label label"},Fe=["href"],Ge={key:0},Re=["href","title"],Ie=Object(o["createElementVNode"])("span",{class:"icon icon-outlink"},null,-1),ze=[Ie],Ue={key:1,class:"multisites-label label"},He={class:"value"},qe={class:"multisites-column"},Ke={class:"value"},We={class:"multisites-column"},$e={class:"value"},Je={class:"multisites-column"},Ye={class:"value"},Qe={key:2,class:"multisites-column"},Xe={class:"value"},Ze=["title"],et={key:0,class:"visits value"},tt=Object(o["createElementVNode"])("img",{class:"multisites_icon",src:"plugins/MultiSites/images/arrow_up.png",alt:""},null,-1),rt=Object(o["createTextVNode"])(),at={style:{color:"green"}},nt=Object(o["createElementVNode"])("img",{class:"multisites_icon",src:"plugins/MultiSites/images/stop.png",alt:""},null,-1),ot=Object(o["createTextVNode"])(),it=Object(o["createElementVNode"])("img",{class:"multisites_icon",src:"plugins/MultiSites/images/arrow_down.png",alt:""},null,-1),st=Object(o["createTextVNode"])(),lt={style:{color:"red"}},ct={key:4,style:{width:"180px"}},ut={key:0,class:"sparkline",style:{width:"100px",margin:"auto"}},dt=["href","title"],mt=["src"];function bt(e,t,r,a,n,i){return Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",{class:Object(o["normalizeClass"])({groupedWebsite:e.website.group,website:!e.website.group,group:e.website.isGroup}),ref:"root"},[e.website.isGroup?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createElementBlock"])("td",Ae,[Object(o["createElementVNode"])("a",{title:"View reports",class:"value truncated-text-line",href:e.dashboardUrl(e.website)},Object(o["toDisplayString"])(e.websiteLabel),9,Fe),e.website.main_url?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",Ge,[Object(o["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.website.main_url,title:e.translate("General_GoTo",e.website.main_url)},ze,8,Re)])):Object(o["createCommentVNode"])("",!0)])),e.website.isGroup?(Object(o["openBlock"])(),Object(o["createElementBlock"])("td",Ue,[Object(o["createElementVNode"])("span",He,Object(o["toDisplayString"])(e.websiteLabel),1)])):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("td",qe,[Object(o["createElementVNode"])("span",Ke,Object(o["toDisplayString"])(e.website.nb_visits),1)]),Object(o["createElementVNode"])("td",We,[Object(o["createElementVNode"])("span",$e,Object(o["toDisplayString"])(e.website.nb_pageviews),1)]),Object(o["createElementVNode"])("td",Je,[Object(o["createElementVNode"])("span",Ye,Object(o["toDisplayString"])(e.website.hits),1)]),e.displayRevenueColumn?(Object(o["openBlock"])(),Object(o["createElementBlock"])("td",Qe,[Object(o["createElementVNode"])("span",Xe,Object(o["toDisplayString"])(e.website.revenue),1)])):Object(o["createCommentVNode"])("",!0),"range"!==e.period?(Object(o["openBlock"])(),Object(o["createElementBlock"])("td",{key:3,class:"multisites-evolution",title:e.website.tooltip},[e.website.isGroup?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",et,[Object(o["withDirectives"])(Object(o["createElementVNode"])("span",null,[tt,rt,Object(o["createElementVNode"])("span",at,Object(o["toDisplayString"])(e.website[e.evolutionMetric]),1)],512),[[o["vShow"],1===e.website["".concat(e.evolutionMetric,"_trend")]]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",null,[nt,ot,Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(e.website[e.evolutionMetric]),1)],512),[[o["vShow"],0===e.website["".concat(e.evolutionMetric,"_trend")]]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",null,[it,st,Object(o["createElementVNode"])("span",lt,Object(o["toDisplayString"])(e.website[e.evolutionMetric]),1)],512),[[o["vShow"],-1===e.website["".concat(e.evolutionMetric,"_trend")]]])]))],8,Ze)):Object(o["createCommentVNode"])("",!0),e.showSparklines?(Object(o["openBlock"])(),Object(o["createElementBlock"])("td",ct,[e.website.isGroup?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",ut,[Object(o["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.dashboardUrl(e.website),title:e.translate("General_GoTo",e.translate("Dashboard_DashboardOf",e.websiteLabel))},[Object(o["createElementVNode"])("img",{alt:"",width:"100",height:"25",src:e.sparklineImage(e.website)},null,8,mt)],8,dt)]))])):Object(o["createCommentVNode"])("",!0)],2)}var pt=Object(o["defineComponent"])({props:{website:{type:Object,required:!0},evolutionMetric:{type:String,required:!0},showSparklines:Boolean,dateSparkline:String,displayRevenueColumn:Boolean,metric:String},mounted:function(){C["Matomo"].postEvent("MultiSites.MultiSitesSite.mounted",{element:this.$refs.root})},unmounted:function(){C["Matomo"].postEvent("MultiSites.MultiSitesSite.unmounted",{element:this.$refs.root})},methods:{dashboardUrl:function(e){return"index.php?module=CoreHome&action=index&date=".concat(this.date,"&period=").concat(this.period)+"&idSite=".concat(e.idsite).concat(this.tokenParam)},sparklineImage:function(e){var t=this.metric;switch(this.evolutionMetric){case"visits_evolution":t="nb_visits";break;case"pageviews_evolution":t="nb_pageviews";break;case"hits_evolution":t="hits";break;case"revenue_evolution":t="revenue";break;default:break}return"index.php?module=MultiSites&action=getEvolutionGraph&period=".concat(this.period,"&date=")+"".concat(this.dateSparkline,"&evolutionBy=").concat(t,"&columns=").concat(t,"&idSite=").concat(e.idsite)+"&idsite=".concat(e.idsite,"&viewDataTable=sparkline").concat(this.tokenParam,"&colors=")+"".concat(encodeURIComponent(JSON.stringify(C["Matomo"].getSparklineColors())))}},computed:{tokenParam:function(){var e=C["MatomoUrl"].urlParsed.value.token_auth;return e?"&token_auth=".concat(e):""},period:function(){return C["Matomo"].period},date:function(){return C["MatomoUrl"].urlParsed.value.date},websiteLabel:function(){return C["Matomo"].helper.htmlDecode(this.website.label)}}});pt.render=bt;var vt=pt;function ht(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ot(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ft(e,t,r){return t&&Ot(e.prototype,t),r&&Ot(e,r),e}function gt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var jt=function(){function e(){var t=this;ht(this,e),gt(this,"privateState",Object(o["reactive"])({sites:[],isLoading:!1,pageSize:25,currentPage:0,totalVisits:"?",totalPageviews:"?",totalHits:"?",totalActions:"?",totalRevenue:"?",searchTerm:"",lastVisits:"?",lastVisitsDate:"?",numberOfSites:0,loadingMessage:Object(C["translate"])("MultiSites_LoadingWebsites"),reverse:!0,sortColumn:"nb_visits",refreshInterval:0,errorLoadingSites:!1})),gt(this,"refreshTimeout",null),gt(this,"fetchAbort",null),gt(this,"state",Object(o["computed"])((function(){return Object(o["readonly"])(t.privateState)}))),gt(this,"numberOfFilteredSites",Object(o["computed"])((function(){return t.state.value.numberOfSites}))),gt(this,"numberOfPages",Object(o["computed"])((function(){return Math.ceil(t.numberOfFilteredSites.value/t.state.value.pageSize-1)}))),gt(this,"currentPagingOffset",Object(o["computed"])((function(){return Math.ceil(t.state.value.currentPage*t.state.value.pageSize)}))),gt(this,"paginationLowerBound",Object(o["computed"])((function(){return t.currentPagingOffset.value+1}))),gt(this,"paginationUpperBound",Object(o["computed"])((function(){var e=t.currentPagingOffset.value+t.state.value.pageSize,r=t.numberOfFilteredSites.value;return e>r&&(e=r),e})))}return ft(e,[{key:"cancelRefereshInterval",value:function(){this.refreshTimeout&&(clearTimeout(this.refreshTimeout),this.refreshTimeout=null)}},{key:"updateWebsitesList",value:function(e){var t=this;if(e){var r=e.sites;r.forEach((function(e){if(1!==e.ratio&&"1"!==e.ratio){var r=C["NumberFormatter"].formatPercent(Math.round(100*parseInt(e.ratio,10))),a=null,n="0",o="0",i="0",s="0";if("nb_visits"!==t.state.value.sortColumn&&"visits_evolution"!==t.state.value.sortColumn||(n=C["NumberFormatter"].formatNumber(e.previous_nb_visits),o=C["NumberFormatter"].formatNumber(e.nb_visits),i=C["NumberFormatter"].formatPercent(e.visits_evolution),a=Object(C["translate"])("General_ColumnNbVisits"),s=C["NumberFormatter"].formatNumber(Math.round(parseInt(e.previous_nb_visits,10)*parseInt(e.ratio,10)))),"pageviews_evolution"===t.state.value.sortColumn&&(n="".concat(e.previous_nb_pageviews),o="".concat(e.nb_pageviews),i=C["NumberFormatter"].formatPercent(e.pageviews_evolution),a=Object(C["translate"])("General_ColumnPageviews"),s=C["NumberFormatter"].formatNumber(Math.round(parseInt(e.previous_nb_pageviews,10)*parseInt(e.ratio,10)))),"hits_evolution"===t.state.value.sortColumn&&(n="".concat(e.previous_hits),o="".concat(e.hits),i=C["NumberFormatter"].formatPercent(e.hits_evolution),a=Object(C["translate"])("General_ColumnHits"),s=C["NumberFormatter"].formatNumber(Math.round(parseInt(e.previous_hits,10)*parseInt(e.ratio,10)))),"revenue_evolution"===t.state.value.sortColumn&&(n=C["NumberFormatter"].formatCurrency(e.previous_revenue,e.currencySymbol),o=C["NumberFormatter"].formatCurrency(e.revenue,e.currencySymbol),i=C["NumberFormatter"].formatPercent(e.revenue_evolution),a=Object(C["translate"])("General_ColumnRevenue"),s=C["NumberFormatter"].formatCurrency(Math.round(parseInt(e.previous_revenue,10)*parseInt(e.ratio,10)),e.currencySymbol)),a)switch(e.tooltip="".concat(Object(C["translate"])("MultiSites_EvolutionComparisonIncomplete",[r]),"\n"),e.tooltip+="".concat(Object(C["translate"])("MultiSites_EvolutionComparisonProportional",[r,"".concat(s),a,"".concat(n)]),"\n"),e.periodName){case"day":e.tooltip+=Object(C["translate"])("MultiSites_EvolutionComparisonDay",["".concat(o),a,"".concat(s),e.previousRange,"".concat(i)]);break;case"week":e.tooltip+=Object(C["translate"])("MultiSites_EvolutionComparisonWeek",["".concat(o),a,"".concat(s),e.previousRange,"".concat(i)]);break;case"month":e.tooltip+=Object(C["translate"])("MultiSites_EvolutionComparisonMonth",["".concat(o),a,"".concat(s),e.previousRange,"".concat(i)]);break;case"year":e.tooltip+=Object(C["translate"])("MultiSites_EvolutionComparisonYear",["".concat(o),a,"".concat(s),e.previousRange,"".concat(i)]);break;default:break}}})),this.privateState.totalVisits=e.totals.nb_visits,this.privateState.totalPageviews=e.totals.nb_pageviews,this.privateState.totalHits=e.totals.hits,this.privateState.totalActions=e.totals.nb_actions,this.privateState.totalRevenue=e.totals.revenue,this.privateState.lastVisits=e.totals.previous_nb_visits,this.privateState.sites=r,this.privateState.numberOfSites=e.numSites,this.privateState.lastVisitsDate=e.lastDate}else this.onError()}},{key:"sortBy",value:function(e){this.state.value.sortColumn===e&&(this.privateState.reverse=!this.state.value.reverse),this.privateState.sortColumn=e,this.fetchAllSites()}},{key:"previousPage",value:function(){this.privateState.currentPage=this.state.value.currentPage-1,this.fetchAllSites()}},{key:"nextPage",value:function(){this.privateState.currentPage=this.state.value.currentPage+1,this.fetchAllSites()}},{key:"searchSite",value:function(e){this.privateState.searchTerm=e,this.privateState.currentPage=0,this.fetchAllSites()}},{key:"fetchAllSites",value:function(){var e=this;this.fetchAbort&&(this.fetchAbort.abort(),this.fetchAbort=null,this.cancelRefereshInterval()),this.privateState.isLoading=!0,this.privateState.errorLoadingSites=!1;var t={method:"MultiSites.getAllWithGroups",hideMetricsDoc:"1",filter_sort_order:"asc",filter_limit:this.state.value.pageSize,filter_offset:this.currentPagingOffset.value,showColumns:["label","nb_visits","nb_pageviews","hits","visits_evolution","visits_evolution_trend","pageviews_evolution","pageviews_evolution_trend","hits_evolution","hits_evolution_trend","revenue_evolution","revenue_evolution_trend","nb_actions","revenue"].join(",")};return this.privateState.searchTerm&&(t.pattern=this.privateState.searchTerm),this.privateState.sortColumn&&(t.filter_sort_column=this.privateState.sortColumn),this.privateState.reverse&&(t.filter_sort_order="desc"),this.fetchAbort=new AbortController,C["AjaxHelper"].fetch(t,{abortController:this.fetchAbort}).then((function(t){e.updateWebsitesList(t)})).catch((function(){e.onError()})).finally((function(){e.privateState.isLoading=!1,e.fetchAbort=null,e.state.value.refreshInterval&&e.state.value.refreshInterval>0&&(e.cancelRefereshInterval(),e.refreshTimeout=setTimeout((function(){e.refreshTimeout=null,e.fetchAllSites()}),1e3*e.state.value.refreshInterval))}))}},{key:"onError",value:function(){this.privateState.errorLoadingSites=!0,this.privateState.sites=[]}},{key:"setRefreshInterval",value:function(e){this.privateState.refreshInterval=e}},{key:"setPageSize",value:function(e){this.privateState.pageSize=e}}]),e}(),St=new jt,kt={ref:"root"},yt={class:"card-title"},Ct=["innerHTML","title"],_t={id:"mt",class:"dataTable card-table",cellspacing:"0"},Nt={class:"heading"},Et={class:"heading"},Vt={class:"heading"},wt={class:"heading"},Tt={class:"heading"},Bt=["colspan"],Pt=["value"],Mt={value:"visits_evolution"},Dt={value:"pageviews_evolution"},xt={value:"hits_evolution"},Lt={key:0,value:"revenue_evolution"},At={key:0},Ft={colspan:"7",class:"allWebsitesLoading"},Gt={key:1},Rt={key:0},It={colspan:"7"},zt={class:"notification system notification-error"},Ut=Object(o["createElementVNode"])("br",null,null,-1),Ht=Object(o["createElementVNode"])("br",null,null,-1),qt=["href"],Kt=Object(o["createTextVNode"])(" – "),Wt=["href"],$t=["href"],Jt=Object(o["createTextVNode"])(". "),Yt={colspan:"8",class:"paging"},Qt={class:"row"},Xt={class:"col s3 add_new_site"},Zt=["href"],er=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1),tr={class:"col s6"},rr={style:{cursor:"pointer"}},ar={class:"dataTablePages"},nr={id:"counter"},or={style:{cursor:"pointer"},class:"pointer"},ir=Object(o["createElementVNode"])("div",{class:"col s3"}," ",-1),sr={row_id:"last"},lr={colspan:"8",class:"site_search"},cr={class:"row"},ur={class:"input-field col s12"},dr=["placeholder"],mr=["title"];function br(e,t,r,a,n,i){var s=this,l=Object(o["resolveComponent"])("EnrichedHeadline"),c=Object(o["resolveComponent"])("ActivityIndicator"),u=Object(o["resolveComponent"])("MultisitesSite");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",kt,[Object(o["createElementVNode"])("h2",yt,[Object(o["createVNode"])(l,{"help-url":e.externalRawLink("https://matomo.org/faq/new-to-piwik/all-websites-dashboard/"),"feature-name":e.translate("General_AllWebsitesDashboard")},{default:Object(o["withCtx"])((function(){return[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("General_AllWebsitesDashboard"))+" ",1),Object(o["createElementVNode"])("span",{class:"smallTitle",innerHTML:e.$sanitize(s.smallTitleContent),title:e.smallTitleTooltip},null,8,Ct)]})),_:1},8,["help-url","feature-name"])]),Object(o["createElementVNode"])("table",_t,[Object(o["createElementVNode"])("thead",null,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("th",{id:"names",class:Object(o["normalizeClass"])(["label",{columnSorted:"label"===e.sortColumn}]),onClick:t[0]||(t[0]=function(t){return e.sortBy("label")})},[Object(o["createElementVNode"])("span",Nt,Object(o["toDisplayString"])(e.translate("General_Website")),1),Object(o["createElementVNode"])("span",{class:Object(o["normalizeClass"])(["arrow",{multisites_asc:!e.reverse&&"label"===e.sortColumn,multisites_desc:e.reverse&&"label"===e.sortColumn}]),style:{"margin-left":"3.5px"}},null,2)],2),Object(o["createElementVNode"])("th",{id:"visits",class:Object(o["normalizeClass"])(["multisites-column",{columnSorted:"nb_visits"===e.sortColumn}]),onClick:t[1]||(t[1]=function(t){return e.sortBy("nb_visits")})},[Object(o["createElementVNode"])("span",{class:Object(o["normalizeClass"])(["arrow",{multisites_asc:!e.reverse&&"nb_visits"===e.sortColumn,multisites_desc:e.reverse&&"nb_visits"===e.sortColumn}]),style:{"margin-right":"3.5px"}},null,2),Object(o["createElementVNode"])("span",Et,Object(o["toDisplayString"])(e.translate("General_ColumnNbVisits")),1)],2),Object(o["createElementVNode"])("th",{id:"pageviews",class:Object(o["normalizeClass"])(["multisites-column",{columnSorted:"nb_pageviews"===e.sortColumn}]),onClick:t[2]||(t[2]=function(t){return e.sortBy("nb_pageviews")})},[Object(o["createElementVNode"])("span",{class:Object(o["normalizeClass"])(["arrow",{multisites_asc:!e.reverse&&"nb_pageviews"===e.sortColumn,multisites_desc:e.reverse&&"nb_pageviews"===e.sortColumn}]),style:{"margin-right":"3.5px"}},null,2),Object(o["createElementVNode"])("span",Vt,Object(o["toDisplayString"])(e.translate("General_ColumnPageviews")),1)],2),Object(o["createElementVNode"])("th",{id:"hits",class:Object(o["normalizeClass"])(["multisites-column",{columnSorted:"hits"===e.sortColumn}]),onClick:t[3]||(t[3]=function(t){return e.sortBy("hits")})},[Object(o["createElementVNode"])("span",{class:Object(o["normalizeClass"])(["arrow",{multisites_asc:!e.reverse&&"hits"===e.sortColumn,multisites_desc:e.reverse&&"hits"===e.sortColumn}]),style:{"margin-right":"3.5px"}},null,2),Object(o["createElementVNode"])("span",wt,Object(o["toDisplayString"])(e.translate("General_ColumnHits")),1)],2),e.displayRevenueColumn?(Object(o["openBlock"])(),Object(o["createElementBlock"])("th",{key:0,id:"revenue",class:Object(o["normalizeClass"])(["multisites-column",{columnSorted:"revenue"===e.sortColumn}]),onClick:t[4]||(t[4]=function(t){return e.sortBy("revenue")})},[Object(o["createElementVNode"])("span",{class:Object(o["normalizeClass"])(["arrow",{multisites_asc:!e.reverse&&"revenue"===e.sortColumn,multisites_desc:e.reverse&&"revenue"===e.sortColumn}]),style:{"margin-right":"3.5px"}},null,2),Object(o["createElementVNode"])("span",Tt,Object(o["toDisplayString"])(e.translate("General_ColumnRevenue")),1)],2)):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("th",{id:"evolution",class:Object(o["normalizeClass"])({columnSorted:e.evolutionSelector===e.sortColumn}),colspan:e.showSparklines?2:1},[Object(o["createElementVNode"])("span",{class:Object(o["normalizeClass"])(["arrow",{multisites_asc:!e.reverse&&e.evolutionSelector===e.sortColumn,multisites_desc:e.reverse&&e.evolutionSelector===e.sortColumn}]),style:{"margin-right":"3.5px"}},null,2),Object(o["createElementVNode"])("span",{class:"evolution",onClick:t[5]||(t[5]=function(t){return e.sortBy(e.evolutionSelector)}),style:{"margin-right":"3.5px"}},Object(o["toDisplayString"])(e.translate("MultiSites_Evolution")),1),Object(o["createElementVNode"])("select",{class:"selector browser-default",id:"evolution_selector",value:e.evolutionSelector,onChange:t[6]||(t[6]=function(t){e.evolutionSelector=t.target.value,e.sortBy(e.evolutionSelector)})},[Object(o["createElementVNode"])("option",Mt,Object(o["toDisplayString"])(e.translate("General_ColumnNbVisits")),1),Object(o["createElementVNode"])("option",Dt,Object(o["toDisplayString"])(e.translate("General_ColumnPageviews")),1),Object(o["createElementVNode"])("option",xt,Object(o["toDisplayString"])(e.translate("General_ColumnHits")),1),e.displayRevenueColumn?(Object(o["openBlock"])(),Object(o["createElementBlock"])("option",Lt,Object(o["toDisplayString"])(e.translate("General_ColumnRevenue")),1)):Object(o["createCommentVNode"])("",!0)],40,Pt)],10,Bt)])]),e.isLoading?(Object(o["openBlock"])(),Object(o["createElementBlock"])("tbody",At,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",Ft,[Object(o["createVNode"])(c,{"loading-message":e.loadingMessage,loading:e.isLoading},null,8,["loading-message","loading"])])])])):Object(o["createCommentVNode"])("",!0),e.isLoading?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createElementBlock"])("tbody",Gt,[e.errorLoadingSites?(Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",Rt,[Object(o["createElementVNode"])("td",It,[Object(o["createElementVNode"])("div",zt,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("General_ErrorRequest","",""))+" ",1),Ut,Ht,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_NeedMoreHelp"))+" ",1),Object(o["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.externalRawLink("https://matomo.org/faq/troubleshooting/faq_19489/")},Object(o["toDisplayString"])(e.translate("General_Faq")),9,qt),Kt,Object(o["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.externalRawLink("https://forum.matomo.org/")},Object(o["toDisplayString"])(e.translate("Feedback_CommunityHelp")),9,Wt),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",null," – ",512),[[o["vShow"],e.areAdsForProfessionalServicesEnabled]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.professionalHelpUrl},Object(o["toDisplayString"])(e.translate("Feedback_ProfessionalHelp")),9,$t),[[o["vShow"],e.areAdsForProfessionalServicesEnabled]]),Jt])])])):Object(o["createCommentVNode"])("",!0),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.sites,(function(t){return Object(o["openBlock"])(),Object(o["createBlock"])(u,{key:t.idsite,website:t,"evolution-metric":e.evolutionSelector,"date-sparkline":e.dateSparkline,"show-sparklines":e.showSparklines,metric:e.sortColumn,"display-revenue-column":e.displayRevenueColumn},null,8,["website","evolution-metric","date-sparkline","show-sparklines","metric","display-revenue-column"])})),128))])),Object(o["createElementVNode"])("tfoot",null,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",Yt,[Object(o["createElementVNode"])("div",Qt,[Object(o["createElementVNode"])("div",Xt,[e.hasSuperUserAccess?(Object(o["openBlock"])(),Object(o["createElementBlock"])("a",{key:0,href:e.addSiteUrl},[er,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("SitesManager_AddSite")),1)],8,Zt)):Object(o["createCommentVNode"])("",!0)]),Object(o["createElementVNode"])("div",tr,[Object(o["withDirectives"])(Object(o["createElementVNode"])("span",{id:"prev",class:"previous dataTablePrevious",onClick:t[7]||(t[7]=function(t){return e.previousPage()})},[Object(o["createElementVNode"])("span",rr,"« "+Object(o["toDisplayString"])(e.translate("General_Previous")),1)],512),[[o["vShow"],!(0===e.currentPage)]]),Object(o["createElementVNode"])("span",ar,[Object(o["createElementVNode"])("span",nr,Object(o["toDisplayString"])(e.translate("General_Pagination",e.paginationLowerBound,e.paginationUpperBound,e.numberOfFilteredSites)),1)]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",{id:"next",class:"next dataTableNext",onClick:t[8]||(t[8]=function(t){return e.nextPage()})},[Object(o["createElementVNode"])("span",or,Object(o["toDisplayString"])(e.translate("General_Next"))+" »",1)],512),[[o["vShow"],!(e.currentPage>=e.numberOfPages)]])]),ir])])]),Object(o["createElementVNode"])("tr",sr,[Object(o["createElementVNode"])("td",lr,[Object(o["createElementVNode"])("div",cr,[Object(o["createElementVNode"])("div",ur,[Object(o["withDirectives"])(Object(o["createElementVNode"])("input",{type:"text",onKeydown:t[9]||(t[9]=Object(o["withKeys"])((function(t){return e.searchSite(e.searchTerm)}),["enter"])),"onUpdate:modelValue":t[10]||(t[10]=function(t){return e.searchTerm=t}),placeholder:e.translate("Actions_SubmenuSitesearch")},null,40,dr),[[o["vModelText"],e.searchTerm]]),Object(o["createElementVNode"])("span",{class:"icon-search search_ico",onClick:t[11]||(t[11]=function(t){return e.searchSite(e.searchTerm)}),title:e.translate("General_ClickToSearch")},null,8,mr)])])])])])])],512)}var pr=Object(o["defineComponent"])({props:{displayRevenueColumn:Boolean,showSparklines:Boolean,dateSparkline:String,pageSize:Number,autoRefreshTodayReport:Number},components:{EnrichedHeadline:C["EnrichedHeadline"],ActivityIndicator:C["ActivityIndicator"],MultisitesSite:vt},data:function(){return{evolutionSelector:"visits_evolution",searchTerm:""}},created:function(){this.pageSize&&St.setPageSize(this.pageSize),this.refresh(this.autoRefreshTodayReport)},methods:{refresh:function(e){St.setRefreshInterval(e),St.fetchAllSites()},sortBy:function(e){St.sortBy(e)},previousPage:function(){St.previousPage()},nextPage:function(){St.nextPage()},searchSite:function(){St.searchSite(this.searchTerm)}},computed:{hasSuperUserAccess:function(){return C["Matomo"].hasSuperUserAccess},date:function(){return C["MatomoUrl"].urlParsed.value.date},idSite:function(){return C["MatomoUrl"].urlParsed.value.idSite},url:function(){return C["Matomo"].piwik_url},period:function(){return C["Matomo"].period},areAdsForProfessionalServicesEnabled:function(){return C["Matomo"].config&&C["Matomo"].config.are_ads_enabled},sortColumn:function(){return St.state.value.sortColumn},reverse:function(){return St.state.value.reverse},smallTitleContent:function(){var e=St.state.value;return Object(C["translate"])("General_TotalVisitsPageviewsActionsRevenue","<strong>".concat(e.totalVisits,"</strong>"),"<strong>".concat(e.totalPageviews,"</strong>"),"<strong>".concat(e.totalActions,"</strong>"),"<strong>".concat(e.totalRevenue,"</strong>"))},smallTitleTooltip:function(){var e=St.state.value;return Object(C["translate"])("General_EvolutionSummaryGeneric",Object(C["translate"])("General_NVisits","".concat(e.totalVisits)),this.date,"".concat(e.lastVisits),e.lastVisitsDate,C["NumberFormatter"].calculateAndFormatEvolution(C["NumberFormatter"].parseFormattedNumber(e.totalVisits),C["NumberFormatter"].parseFormattedNumber(e.lastVisits)))},loadingMessage:function(){return St.state.value.loadingMessage},isLoading:function(){return St.state.value.isLoading},errorLoadingSites:function(){return St.state.value.errorLoadingSites},sites:function(){return St.state.value.sites},numberOfPages:function(){return St.numberOfPages.value},currentPage:function(){return St.state.value.currentPage},paginationLowerBound:function(){return St.paginationLowerBound.value},paginationUpperBound:function(){return St.paginationUpperBound.value},numberOfFilteredSites:function(){return St.numberOfFilteredSites.value},professionalHelpUrl:function(){return Object(C["externalRawLink"])("https://matomo.org/support-plans/")},addSiteUrl:function(){return"index.php?module=SitesManager&action=index&showaddsite=1&period=".concat(this.period,"&")+"date=".concat(this.date,"&idSite=").concat(this.idSite)}}});pr.render=br;var vr=pr;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=MultiSites.umd.min.js.map